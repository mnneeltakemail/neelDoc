# **1. 当前区块链系统的可扩展性限制和挑战** {#Waves-NGProtocol-1.ScalabilityLimitsandChallengesinCurrentBlockchainSystems}

## **1.1 问题陈述和动机** {#Waves-NGProtocol-1.1ProblemStatementandMotivation}

区块链协议具有一些可扩展性限制和挑战，使其在吞吐量和延迟之间进行权衡。 目前的区块链技术速度不够快，无法扩展并将更多交易纳入系统，因此我们需要考虑性能挑战。

在矿工，消费者和开发人员之间达成一个统一的协议，我们需要部署可伸缩性措施，并且关于如何提高比特币的可伸缩性一直存在争议。目前的建议主要集中在如何制造区块，以及如何增加未来处理区块规模。

所有提案都遇到主要的可伸缩性瓶颈:
无论选择多大的区块，区块链系统最多可以达到一个合适的交易吞吐量，从每秒约3个交易增加到每秒约7个交易。这还远不及于每秒3万次的交易，与现有系统(如VISA交易)竞争的必要条件。莱特币、以太坊和其他所有共享比特币区块链协议的货币都处于同样的主要限制。


Waves-NG将通过使网络达到最高的吞吐量来解决可伸缩性瓶颈，这取决于网络的状态。它不仅可以提高交易吞吐量，还可以减少交易延迟的情况。因此，它可以在几秒内\(而不是在几分钟内\)得到初始的交易确认。

|  | 延迟\(区块间隔\) | 区块大小 | 速度 |
| :--- | :--- | :--- | :--- |
| 比特币 | 10分钟 | 1 Mb | 3-7 Tx/秒 |
| 以太坊 | 10分钟 | 1 Mb | 5-20 Tx/秒 |
| Waves | 1分钟 | 1 Mb.100 Tx/区块 | 1.6 Tx/秒 |
| Waves-NG | 关键区块之间1分钟，微区块之间3秒 | 1 Mb.65535Tx/关键区块.200 Tx/微区块 | 100 Tx/秒 |

表1，比特币、以太坊、Waves和Waves-NG的可伸缩性比较。

![](/_assets/waves_dex_ng.jpg)

## **1.2 当前提高可伸缩性提议的弱点** {#Waves-NGProtocol-1.2WeaknessesofCurrentProposalstoImproveScalability}

区块链系统可以处理交易，而这些交易的最大速率受两个参数的选择限制:区块大小和区块间隔。

* •	区块间隔定义了两个区块创建时的平均时间间隔。通过决定减少区块间隔来解决等待时间限制，由于每秒会有新矿工的原因，系统将具有较低的安全性\(增加分叉概率\)，这将导致区块链受到重组而不稳定，并且系统处于分歧\(图1\)。如果我们减少每个区块的时间，那么我们就会遇到这样一种情况，在这个情况下，大量的区块在更短的时间解决，而不是在整个网络中传递一个已解决的区块。因此，是不可能知道哪个区块是“真正的”，哪个是“分叉”，因为似乎交易由需要有多个确认突然变为有很少的确认\(或可能返回未被确认\)。

![](/_assets/BlockInterval.PNG)

图1，使用静态块大小增加区块频率会降低安全性。

* 系统的吞吐量受最大区块大小\(在固定的区块间隔情况下\)的限制，因为交易最大数量直接取决于区块大小。

但较大的区块会导致较慢的传播速度，从而导致更多被丢弃的区块\(孤立风险\)。例如，无限大小的区块可因为花费很长创建时间验证而导致DoS攻击系统。如果选择增加区块大小以提高吞吐量，那网络中传播的时间更长而导致出现网络峰值\(图2\)。

![](/_assets/Block Size.JPG)

图2，用静态区块频率增加区块的大小将导致更多的废弃区块和网络峰值。

## **1.3 关于Bitcoin-NG的简要总结** {#Waves-NGProtocol-1.3BriefSummaryofBitcoin-NG}

Bitcoin NG 是下一代区块链协议，一种可以替代比特币的缩放解决方案，不涉及增加区块大小或减少区块时间间隔。这降低了在其他优势中的分叉风险。Bitcoin- ng描述了比特币的基本权衡是可以通过其他区块链协议来减少，这提供了只有网络平面才能达成的延迟共识和限制带宽。该协议将时间定为时间周期\(新纪元\)。在每个期间内，一个特定的领导会负责交易序列化\(图3\)。

领导们生成区块采取的规则是：

* 关键区块用来选择“领导”.
* 微区块用来记录账目.

![](/_assets/Serialization.JPG)

图3, 具有序列化交易的Bitcoin-NG时间段结构。

# **2. Waves-NG 覆盖图** {#Waves-NGProtocol-2.Waves-NGOverlay}

Waves-NG 基于比特币下一代协议，将交易序列化，并且在不丧失其他属性的情况下，与比特币相比，在交易延迟\(较低延迟\)和带宽（较高吞吐量）方面有重要改进。

Waves 通过持续方式提供矿工在挖矿期间开采区块的能力来处理这种可扩展性问题。将该区块继续增量称为液体区块。当下一个区块参照被创建和附加时，这个液体区块是不变的。

这个方法增加了有效带宽和提高区块创建速度，这被描述为使用Waves平台的“对企业尤其重要”，因为它允许在没有任何延迟情况下进行微交易——是传统区块链系统的典型特征。

此外，它还允许平台承受高负载，例如在众包和空投奖励代币之后分发代币。在Waves去中心化交易所\(DEX\)上处理交易的速度也提高了。

## **2.1 Waves-NG 操作** {#Waves-NGProtocol-2.1Waves-NGoperations}

Waves的主要和核心思想是将液体区块分成两种类型，关键区块和微区块。创建液体区块的过程如下:

* 矿工节点获得创建区块的权限。
* 矿工节点创建和发送关键区块\(不包含交易\_。
* 矿工节点创建并发送微区块\(包含与前一个微型区块或关键区块参数的相同交易\)，开采时间间隔为3秒。
* 矿工将这些微区块转播到网络上，直到下一个新的关键区块参考液体块出现。

所有的交易都是同一个区块的一部分，并一起贡献的。在这两个区块之间，传统的比特币系统对旁观者来说显得无足轻重，因为矿工们正在努力发掘下一个区块，但在共识方面，却没有明显进展。

相反的是，在Waves-NG中，关键区块可以是小的，因为它们只需要包含coinbase交易，该交易定义了矿工将用于签署微型区块的公钥。
因为一个关键区块需要权益证明，矿工不能只生产一个，并随意征用领导层。

在关键区块之后，矿工领导可以快速地发出微区块，只需通过与关键区块的coinbase中指定的公钥相对应的私钥\(图4\)签名即可

![](/_assets/Bitcoin Blocks.JPG)

图4:关键区块和微区块签名过程。

## **2.1.1 “领导”区块** {#Waves-NGProtocol-2.1.1Leaderblocks}

它也被称为“关键区块”，这些区块是通过权益证明而生成的，但不包含交易。

他们担任领导选举机制，并包含标识所选领导的公共密钥。

每个区块都有一个标题，其中包含其前一个标题的唯一引用（包括前一个标题的密码散列\(关键区块或微区块\)。

正如比特币，要使关键区块有效，其顶端的密码散列必须小于目标值。 与比特币不同，关键区块包含一个随后将使用的微型区块公钥。

## **2.1.2 微区块** {#Waves-NGProtocol-2.1.2Microblocks}

一旦节点生成关键区块，它就成为领导。 作为领导，允许节点以小于预定义最大值的设定速率生成微区块。

这些微区块将包含分类账项目，而不需要任何权益证明，并且它们由每个区块生成周期中选出的领导。

该区块生成周期由“领导”区块启动。

唯一的要求是由选出的领导的私钥来签署微区块。

微区块可以由当选领导\(矿工\)以非常快的速度生成，从而提高性能和交易速度。

一个有效的微块，它的所有条目必须根据状态机的规范才能有效，并且必须拥有有效的签名。图5演示了该结构。
关键是，微区块不影响链的重量，因为它们不包含权益证明。

当所有的微区块都经过验证时，它们将和关键区块合并到一个区块中。

## **2.2 Waves-NG奖励机制** {#Waves-NGProtocol-2.2Waves-NGrewardmechanisms}

报酬由两部分组成。首先，每个关键区块赋予它的生成器一个固定数目。第二，每个分类账都有收费。

该费用分发给将此条目放置在一个微区块中的领导和生成下一个关键区块的后续领导。

为了激励参与者遵守协议，Waves-NG采用了以下机制:

每笔交易都向系统支付费用，但与比特币不同的是，这一费用是分配的，40%给了领导，60%给了后续的领导。

最后，如果一位“领导”将同一个根源生成两个微区块产生分叉，将受到撤销补贴收入的处罚; 谁发现了这种欺诈行为就会获得一些奖励\(图5\)。

![](/_assets/Capture 4.jpg)

图5: Waves-NG协议的链结构。在最后一个关键区块\(正方形\)中，用与公钥匹配的私钥对微型区块\(圆\)进行签名。当前的领导获得40%的回报，60%给下一个领导。

在实践中，薪酬是通过由每个关键区块包含一个单一的coinbase交易，该交易可以铸造新硬币并将资金存给当前和上一个领导。

就像比特币一样，这个交易只能在100个关键区块的成熟期之后使用，以避免分叉产生之后发生不可合并交易。

**提示.** 点击 [**这里**](/technical-details/waves-ng-solution.md) 可以找到更多关于Wave-NG的技术细节。
